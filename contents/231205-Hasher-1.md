# Hasher(1) ğŸ¤¿

**ì§‘í•© ë° ì‚¬ì „ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë²”ìš© í•´ì‹œ í•¨ìˆ˜ì…ë‹ˆë‹¤.**

```swift
@frozen
struct Hasher
```

## 1ï¸âƒ£ ê°œìš”

Swift í”„ë¡œê·¸ë¨ì—ì„œ **`Hasher`** ëŠ” ì„ì˜ì˜ ë°”ì´íŠ¸ ì‹œí€€ìŠ¤ë¥¼ ì •ìˆ˜ í•´ì‹œ ê°’ìœ¼ë¡œ ë§¤í•‘í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë°ì´í„°ë¥¼ í•´ì‹œì— í”¼ë“œí•˜ê¸° ìœ„í•´ ë³€í˜• ê°€ëŠ¥í•œ **`combine`** ë©”ì†Œë“œë“¤ì„ ì¼ë ¨ì˜ í˜¸ì¶œì„ í†µí•´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•´ì‹œì— ë°ì´í„°ë¥¼ ëª¨ë‘ í”¼ë“œí•œ í›„ì—ëŠ” **`finalize()`** ë¥¼ í˜¸ì¶œí•˜ì—¬ í•´ì‹œ ê°’ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
var hasher = Hasher()
hasher.combine(23)
hasher.combine("Hello")
let hashValue = hasher.finalize()
```

Swift í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì¤‘ì— **`Hasher`** ëŠ” ì •í™•íˆ ê°™ì€ ë°”ì´íŠ¸ ì‹œí€€ìŠ¤ë¥¼ í”¼ë“œí•  ê²½ìš° í•­ìƒ ë™ì¼í•œ í•´ì‹œê°’ì„ ìƒì„±í•œë‹¤ëŠ” ê²ƒì„ ë³´ì¥í•©ë‹ˆë‹¤.

ê·¸ëŸ¬í•˜ ê¸°ë³¸ **'í•´ì‹œ ì•Œê³ ë¦¬ì¦˜'** ì€ **'ëˆˆì‚¬íƒœ íš¨ê³¼(avalanche effects)'** ë¥¼ ë‚˜íƒ€ë‚´ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
- ì‹œë“œë‚˜ ì…ë ¥ ë°”ì´íŠ¸ ì‹œí€€ìŠ¤ì˜ ì•½ê°„ì˜ ë³€ê²½ì€ ì¼ë°˜ì ìœ¼ë¡œ ìƒì„±ëœ í•´ì‹œ ê°’ì— ê·¹ì ì¸ ë³€í™”ë¥¼ ì¼ìœ¼í‚µë‹ˆë‹¤.

> ğŸ“ Note
> 
> í”„ë¡œê·¸ë¨ ì‹¤í–‰ ê°„ì— í•´ì‹œ ê°’ì„ ì €ì¥í•˜ê±°ë‚˜ ì¬ì‚¬ìš©í•˜ì§€ ë§ˆì‹­ì‹œì˜¤ **'Hasher'** ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë¬´ì‘ìœ„ë¡œ ì‹œë“œë˜ë¯€ë¡œ í”„ë¡œê·¸ë¨ì˜ ìƒˆ ì‹¤í–‰ë§ˆë‹¤ ë‹¤ë¥¸ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
> 
> **'Hasher'** ì— ì˜í•´ êµ¬í˜„ëœ **"í•´ì‹œ ì•Œê³ ë¦¬ì¦˜"** ì€ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì–´ë–¤ ë‘ ë²„ì „ ì‚¬ì´ì—ì„œë„ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ¤” í•´ì‹œ(hash)? ê·¸ê²Œ ì–´ë–¤ ì˜ë¯¸ì¸ê°€ìš”?
> 
> ğŸ™‹â€â™‚ï¸ **'í•´ì‹œ(hash)'** ëŠ” ë°ì´í„°ë¥¼ íŠ¹ì •í•œ ê¸¸ì´ì˜ ê°’ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì„ ë§í•˜ë©°, ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ë¥¼ í•´ì‹œ í•¨ìˆ˜ë¼ê³  í•©ë‹ˆë‹¤.
> 
> í•´ì‹œì˜ ê¸°ë³¸ ì•„ì´ë””ì–´ëŠ” ì–´ë–¤ ê¸¸ì´ì˜ ë°ì´í„°ë“  ê³ ì •ëœ í¬ê¸°ì˜ ìœ ì¼í•œ ê°’ì„ ìƒì„±í•˜ëŠ” ê²ƒ ì…ë‹ˆë‹¤.
> í•´ì‹œëŠ” ì—¬ëŸ¬ ë¶„ì•¼ì—ì„œ ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤.
> 
> í•´ì‹œì˜ ì£¼ìš” íŠ¹ì§•ê³¼ ìš©ë„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
> 
> **1. ë°ì´í„°ì˜ ì••ì¶•.**
> í•´ì‹œ í•¨ìˆ˜ëŠ” ì„ì˜ ê¸¸ì´ì˜ ë°ì´í„°ë¥¼ ê³ ì •ëœ ê¸¸ì´ì˜ í•´ì‹œ ê°’ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
> ì´ ê³¼ì •ì—ì„œ ì›ë³¸ ë°ì´í„°ì˜ í¬ê¸°ì— ê´€ê³„ì—†ì´ ì¼ì •í•œ í¬ê¸°ì˜ ê²°ê³¼ê°’ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> 
> **2. ë°ì´í„°ì˜ ìœ ì¼ì„±.**
> ì´ìƒì ì¸ í•´ì‹œ í•¨ìˆ˜ëŠ” ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„°ì— ëŒ€í•´ ê°€ëŠ¥í•œ í•œ ê³ ìœ í•œ í•´ì‹œ ê°’ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.
> í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„°ê°€ ë™ì¼í•œ í•´ì‹œê°’ì„ ê°€ì§ˆ ìˆ˜ ìˆëŠ” 'ì¶©ëŒ'ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> 
> **3. ë°ì´í„° ê²€ìƒ‰ì˜ íš¨ìœ¨ì„± ì¦ëŒ€.**
> í•´ì‹œëŠ” ë°ì´í„°ë¥¼ ì‹ ì†í•˜ê²Œ ê²€ìƒ‰í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
> ì˜ˆë¥¼ ë“¤ì–´, í•´ì‹œ í…Œì´ë¸”ì€ í•´ì‹œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ì €ì¥í•˜ê³  ê²€ìƒ‰í•˜ëŠ” ë° í™œìš©ë©ë‹ˆë‹¤.
> 
> **4. ë³´ì•ˆ ëª©ì .**
> ì•”í˜¸í•™ì—ì„œ í•´ì‹œ í•¨ìˆ˜ëŠ” ë°ì´í„°ì˜ ë¬´ê²°ì„±ì„ ê²€ì¦í•˜ê³ , ë¹„ë°€ ë²ˆí˜¸í™” ê°™ì€ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
> í•´ì‹œ í•¨ìˆ˜ëŠ” ì›ë³¸ ë°ì´í„°ë¥¼ ë³µêµ¬í•˜ê¸° ì–´ë µê²Œ ë§Œë“¤ì–´ ë³´ì•ˆì„ ê°•í™”í•©ë‹ˆë‹¤.
> 
> **5. ë°ì´í„° ë¬´ê²°ì„± í™•ì¸.**
> í•´ì‹œëŠ” ë°ì´í„°ê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
> ë°ì´í„°ì— í•´ì‹œ í•¨ìˆ˜ë¥¼ ì ìš©í•œ í›„, ì €ì¥ëœ í•´ì‹œ ê°’ê³¼ ìƒˆë¡œ ê³„ì‚°í•œ í•´ì‹œ ê°’ì„ ë¹„êµí•˜ì—¬ ë°ì´í„°ì˜ ë¬´ê²°ì„±ì„ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 2ï¸âƒ£ ë‚´ë¶€ ì½”ë“œ ëœ¯ì–´ ë¨¹ê¸° ëƒ ëƒ  ğŸ—

### ğŸ™‹â€â™‚ï¸ í•¨ì¹œì†Œ(í•¨ìˆ˜ ì¹œêµ¬ë¥¼ ì†Œê°œí•©ë‹ˆë‹¤)

#### 1ï¸âƒ£ `_loadPartialUnalignedUInt64LE`

```swift
@inline(__always)
internal func _loadPartialUnalignedUInt64LE(
  _ p: UnsafeRawPointer,
  byteCount: Int
) -> UInt64 {
  var result: UInt64 = 0
  switch byteCount {
  case 7:
    result |= UInt64(p.load(fromByteOffset: 6, as: UInt8.self)) &<< 48
    fallthrough
  case 6:
    result |= UInt64(p.load(fromByteOffset: 5, as: UInt8.self)) &<< 40
    fallthrough
  case 5:
    result |= UInt64(p.load(fromByteOffset: 4, as: UInt8.self)) &<< 32
    fallthrough
  case 4:
    result |= UInt64(p.load(fromByteOffset: 3, as: UInt8.self)) &<< 24
    fallthrough
  case 3:
    result |= UInt64(p.load(fromByteOffset: 2, as: UInt8.self)) &<< 16
    fallthrough
  case 2:
    result |= UInt64(p.load(fromByteOffset: 1, as: UInt8.self)) &<< 8
    fallthrough
  case 1:
    result |= UInt64(p.load(fromByteOffset: 0, as: UInt8.self))
    fallthrough
  case 0:
    return result
  default:
    _internalInvariantFailure()
  }
}
```

ì´ í•¨ìˆ˜ëŠ” **"ë©”ëª¨ë¦¬ì—ì„œ ë¶€ë¶„ì ìœ¼ë¡œ ì •ë ¬ë˜ì§€ ì•Šì€ 'UInt64' ê°’ì„ ì½ì–´ì˜¤ëŠ” ë‚´ë¶€(internal)í•¨ìˆ˜"** ì…ë‹ˆë‹¤.

##### âœ… 1. `@inline(__always)`

```swift
@inline(__always)
```

ì´ ì–´ë…¸í…Œì´ì…˜ì€ ì»´íŒŒì¼ëŸ¬ì—ê²Œ ì´ í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ í•­ìƒ ì¸ë¼ì¸(inline)ì²˜ë¦¬ë˜ì–´ì•¼ í•¨ì„ ì§€ì‹œí•©ë‹ˆë‹¤.
ì¸ë¼ì¸ ì²˜ë¦¬ëŠ” í•¨ìˆ˜ í˜¸ì¶œ ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì´ê³  ì„±ëŠ¥ì„ í–¥ìƒ ì‹œí‚¤ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

##### âœ… 2. `internal func _loadPartialUnalignedUInt64LE(_ p: UnsafeRawPointer, byteCount: Int) -> UInt64`

```swift
internal func _loadPartialUnalignedUInt64LE(_ p: UnsafeRawPointer, byteCount: Int) -> UInt64
```

ì´ í•¨ìˆ˜ëŠ” **`UnsafeRawPointer`** íƒ€ì…ì˜ í¬ì¸í„° **`p`** ì™€ ì½ì–´ì˜¬ ë°”ì´íŠ¸ ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” `byteCount`ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ìŠµë‹ˆë‹¤.

í•¨ìˆ˜ëŠ” **`UInt64`** íƒ€ì…ì˜ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

##### âœ… 3. `switchë¬¸` 

```swift
switch byteCount {
  case 7:
    result |= UInt64(p.load(fromByteOffset: 6, as: UInt8.self)) &<< 48
    fallthrough
  case 6:
    result |= UInt64(p.load(fromByteOffset: 5, as: UInt8.self)) &<< 40
    fallthrough
  case 5:
    result |= UInt64(p.load(fromByteOffset: 4, as: UInt8.self)) &<< 32
    fallthrough
  case 4:
    result |= UInt64(p.load(fromByteOffset: 3, as: UInt8.self)) &<< 24
    fallthrough
  case 3:
    result |= UInt64(p.load(fromByteOffset: 2, as: UInt8.self)) &<< 16
    fallthrough
  case 2:
    result |= UInt64(p.load(fromByteOffset: 1, as: UInt8.self)) &<< 8
    fallthrough
  case 1:
    result |= UInt64(p.load(fromByteOffset: 0, as: UInt8.self))
    fallthrough
  case 0:
    return result
  default:
    _internalInvariantFailure()
  }
```

**`byteCount`** ì˜ ê°’ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•©ë‹ˆë‹¤.

ê° **`case`** ëŠ” ë¡œë“œí•  ë°”ì´íŠ¸ ìˆ˜ì— ë”°ë¼ í•´ë‹¹ ë°”ì´íŠ¸ë¥¼ ë¡œë“œí•˜ê³ , ì´ë¥¼ **`result`** ë³€ìˆ˜ì— ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ë°°ì¹˜í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, **`byteCount`** ê°€ 7ì¸ ê²½ìš°, 7ë²ˆì§¸ ë°”ì´íŠ¸ë¥¼ ë¡œë“œí•˜ì—¬ **`result`** ì˜ 48~55ë²ˆ ë¹„íŠ¸ì— ë°°ì¹˜í•©ë‹ˆë‹¤.

**`fallthrough`** í‚¤ì›Œë“œëŠ” **`switch`** ë¬¸ì—ì„œ ë‹¤ìŒ **`case`** ë¡œ ê³„ì† ì§„í–‰í•˜ë„ë¡ í•©ë‹ˆë‹¤.

ì´ë¥¼ í†µí•´ ê° ë°”ì´íŠ¸ë¥¼ ì°¨ë¡€ëŒ€ë¡œ ë¡œë“œí•˜ê³  **`result`** ì— ëˆ„ì í•©ë‹ˆë‹¤.

##### âœ… 4. ê²°ê³¼ ë°˜í™˜.

**`case 0`** ì—ì„œëŠ” **`result`** ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
ì´ëŠ” ë¡œë“œí•  ë°”ì´íŠ¸ê°€ ì—†ì„ ë•Œì˜ ê²½ìš°ì…ë‹ˆë‹¤.

##### âœ… 5. ë””í´íŠ¸ ì¼€ì´ìŠ¤.

**`default`** ì¼€ì´ìŠ¤ì—ì„œëŠ” ë‚´ë¶€ ë¶ˆë³€ì„± ê²€ì¦ ì‹¤íŒ¨ë¥¼ ë‚˜íƒ€ë‚´ëŠ” **`_internalInvariantFailure()`** í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
ì´ëŠ” **`byteCount`** ê°€ ì˜ˆìƒ ë²”ìœ„ë¥¼ ë²—ì–´ë‚œ ê²½ìš°ì— ë°œìƒí•©ë‹ˆë‹¤.

#### âœ…ğŸ“ ìš”ì•½.

ì´ í•¨ìˆ˜ëŠ” ì£¼ì–´ì§„ ë©”ëª¨ë¦¬ ì£¼ì†Œì—ì„œ ìµœëŒ€ 8ë°”ì´íŠ¸ê¹Œì§€ì˜ ë°ì´í„°ë¥¼ **`UInt64`** ê°’ìœ¼ë¡œ ë¡œë“œí•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
ì´ ê³¼ì •ì—ì„œ ë°ì´í„°ì˜ ì •ë ¬ì´ë‚˜ ì „ì²´ 8ë°”ì´íŠ¸ë¥¼ ë¡œë“œí•˜ì§€ ì•ŠëŠ” ê²½ìš°ë„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### ì°¸ê³ ìë£Œ ğŸ“š

- [Apple Developer Documentation - Hasher](https://developer.apple.com/documentation/swift/hasher)
- [Swift Repository - Hasher](https://github.com/apple/swift/blob/main/stdlib/public/core/Hasher.swift)
